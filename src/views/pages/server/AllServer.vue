<template>
  <div class="server" v-if="servers">
    <div class="server__wrap">
      <div class="server__card" v-for="(server, index) in servers">
        <div class="server__card-info">
          <div class="server__card-head">
            <div class="server__card-title">
              {{ server.title }}
              <span>
                 {{server.type}}
              </span>
            </div>
            <div class="server__card-btn">
              <button @click.prevent="deleteServer(server.id)">
                <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4.46875 4.46875C4.57649 4.46875 4.67983 4.51155 4.75601 4.58774C4.8322 4.66392 4.875 4.76726 4.875 4.875V9.75C4.875 9.85774 4.8322 9.96108 4.75601 10.0373C4.67983 10.1134 4.57649 10.1562 4.46875 10.1562C4.36101 10.1562 4.25767 10.1134 4.18149 10.0373C4.1053 9.96108 4.0625 9.85774 4.0625 9.75V4.875C4.0625 4.76726 4.1053 4.66392 4.18149 4.58774C4.25767 4.51155 4.36101 4.46875 4.46875 4.46875ZM6.5 4.46875C6.60774 4.46875 6.71108 4.51155 6.78726 4.58774C6.86345 4.66392 6.90625 4.76726 6.90625 4.875V9.75C6.90625 9.85774 6.86345 9.96108 6.78726 10.0373C6.71108 10.1134 6.60774 10.1562 6.5 10.1562C6.39226 10.1562 6.28892 10.1134 6.21274 10.0373C6.13655 9.96108 6.09375 9.85774 6.09375 9.75V4.875C6.09375 4.76726 6.13655 4.66392 6.21274 4.58774C6.28892 4.51155 6.39226 4.46875 6.5 4.46875ZM8.9375 4.875C8.9375 4.76726 8.8947 4.66392 8.81851 4.58774C8.74233 4.51155 8.63899 4.46875 8.53125 4.46875C8.42351 4.46875 8.32017 4.51155 8.24399 4.58774C8.1678 4.66392 8.125 4.76726 8.125 4.875V9.75C8.125 9.85774 8.1678 9.96108 8.24399 10.0373C8.32017 10.1134 8.42351 10.1562 8.53125 10.1562C8.63899 10.1562 8.74233 10.1134 8.81851 10.0373C8.8947 9.96108 8.9375 9.85774 8.9375 9.75V4.875Z" fill="#CBCFE6"/>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M11.7812 2.4375C11.7812 2.65299 11.6956 2.85965 11.5433 3.01202C11.3909 3.1644 11.1842 3.25 10.9688 3.25H10.5625V10.5625C10.5625 10.9935 10.3913 11.4068 10.0865 11.7115C9.7818 12.0163 9.36848 12.1875 8.9375 12.1875H4.0625C3.63152 12.1875 3.2182 12.0163 2.91345 11.7115C2.6087 11.4068 2.4375 10.9935 2.4375 10.5625V3.25H2.03125C1.81576 3.25 1.6091 3.1644 1.45673 3.01202C1.30435 2.85965 1.21875 2.65299 1.21875 2.4375V1.625C1.21875 1.40951 1.30435 1.20285 1.45673 1.05048C1.6091 0.898102 1.81576 0.8125 2.03125 0.8125H4.875C4.875 0.597012 4.9606 0.390349 5.11298 0.237976C5.26535 0.0856024 5.47201 0 5.6875 0L7.3125 0C7.52799 0 7.73465 0.0856024 7.88702 0.237976C8.0394 0.390349 8.125 0.597012 8.125 0.8125H10.9688C11.1842 0.8125 11.3909 0.898102 11.5433 1.05048C11.6956 1.20285 11.7812 1.40951 11.7812 1.625V2.4375ZM3.34588 3.25L3.25 3.29794V10.5625C3.25 10.778 3.3356 10.9847 3.48798 11.137C3.64035 11.2894 3.84701 11.375 4.0625 11.375H8.9375C9.15299 11.375 9.35965 11.2894 9.51202 11.137C9.6644 10.9847 9.75 10.778 9.75 10.5625V3.29794L9.65413 3.25H3.34588ZM2.03125 2.4375V1.625H10.9688V2.4375H2.03125Z" fill="#CBCFE6"/>
                </svg>
              </button>
              <button @click.prevent="$router.push(`/edit-server/${server.id}/${$route.params.id}`)">
                <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3.7749 11.0156C3.8042 11.0156 3.8335 11.0127 3.86279 11.0083L6.32666 10.5762C6.35596 10.5703 6.38379 10.5571 6.4043 10.5352L12.6138 4.32568C12.6273 4.31213 12.6381 4.29604 12.6455 4.27831C12.6528 4.26059 12.6566 4.2416 12.6566 4.22241C12.6566 4.20323 12.6528 4.18423 12.6455 4.16651C12.6381 4.14879 12.6273 4.13269 12.6138 4.11914L10.1792 1.68311C10.1514 1.65527 10.1147 1.64062 10.0752 1.64062C10.0356 1.64062 9.99902 1.65527 9.97119 1.68311L3.76172 7.89258C3.73975 7.91455 3.72656 7.94092 3.7207 7.97021L3.28857 10.4341C3.27432 10.5126 3.27942 10.5933 3.30341 10.6694C3.3274 10.7454 3.36957 10.8145 3.42627 10.8706C3.52295 10.9644 3.64453 11.0156 3.7749 11.0156ZM4.76221 8.46094L10.0752 3.14941L11.1489 4.22314L5.83594 9.53467L4.53369 9.76465L4.76221 8.46094ZM12.8906 12.2461H2.10938C1.8501 12.2461 1.64062 12.4556 1.64062 12.7148V13.2422C1.64062 13.3066 1.69336 13.3594 1.75781 13.3594H13.2422C13.3066 13.3594 13.3594 13.3066 13.3594 13.2422V12.7148C13.3594 12.4556 13.1499 12.2461 12.8906 12.2461Z" fill="#B4B8CC"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="server__card-body" >
            <div class="server__card-host">
              <p>Хост</p>
              <span>{{ server.host }}</span>
              <button @click="copy($event)">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                </svg>
              </button>
            </div>
            <div class="server__card-tab" >
              <button v-for="(tab, idx) in server.db_ftp" :key="idx" :class="{active: tab.active}" @click="tabFun(tab,index)">{{tab.tab}}</button>
            </div>
            <div class="server__card-list" v-for="(tab, index) in server.db_ftp" :key="index" v-if="tab.active">
              <ul>

                <li v-if="tab.tab === 'ftp'">
                  <p>Порт</p>
                  <span>{{ tab.data.port }}</span>
                  <button @click="copy($event)">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                    </svg>
                  </button>
                </li>
                <li v-else>
                  <p>Хост</p>
                  <span>{{ tab.data.host }}</span>
                  <button @click="copy($event)">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                    </svg>
                  </button>
                </li>


                <li v-if="tab.tab === 'ftp'">
                  <p>Хост</p>
                  <span>{{ tab.data.host }}</span>
                  <button @click="copy($event)">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                    </svg>
                  </button>
                </li>
                <li v-else>
                  <p>Имя базы данных</p>
                  <span>{{ tab.data.db_name }}</span>
                  <button @click="copy($event)">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                    </svg>
                  </button>
                </li>

                <li>
                  <p>Логин</p>
                  <span>{{ tab.data.login }}</span>
                  <button @click="copy($event)">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                    </svg>
                  </button>
                </li>

                <li>
                  <p>Пароль</p>
                  <span>{{ tab.data.password }}</span>
                  <button @click="copy($event)">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9.75 0.75H3.46875C3.41719 0.75 3.375 0.792187 3.375 0.84375V1.5C3.375 1.55156 3.41719 1.59375 3.46875 1.59375H9.28125V9.65625C9.28125 9.70781 9.32344 9.75 9.375 9.75H10.0312C10.0828 9.75 10.125 9.70781 10.125 9.65625V1.125C10.125 0.917578 9.95742 0.75 9.75 0.75ZM8.25 2.25H2.25C2.04258 2.25 1.875 2.41758 1.875 2.625V8.84414C1.875 8.94375 1.91484 9.03867 1.98516 9.10898L4.01602 11.1398C4.0418 11.1656 4.07109 11.1867 4.10273 11.2043V11.2266H4.15195C4.19297 11.2418 4.23633 11.25 4.28086 11.25H8.25C8.45742 11.25 8.625 11.0824 8.625 10.875V2.625C8.625 2.41758 8.45742 2.25 8.25 2.25ZM4.47656 10.5H4.47422L2.71875 8.74453V8.74219H4.47656V10.5Z" fill="#CBCFE6"/>
                    </svg>
                  </button>
                </li>
              </ul>
              <div class="server__card-desc">
                <p>Описание</p>
                <span>{{ tab.data.description }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <button class="server__add" @click="$router.push(`/add-server/${$route.params.id}`)">
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 8.4718H8.46612V14H5.56263V8.4718H0V5.55692H5.56263V0H8.46612V5.55692H14V8.4718Z" fill="white"/>
      </svg>
      Добавить сервер
    </button>
  </div>
</template>

<script>
export default {
  data(){
    return{
      tab_active: 0
    }
  },
  async mounted() {
    try {
      await this.$store.dispatch('serverAll', this.$route.params.id)
    }catch (e) {}
  },
  methods:{
    tabFun(e, index){
        for(let el of this.servers[index].db_ftp){
          el.active = false
        }
        e.active = true
    },
    async deleteServer(id){
      try {
        await this.$store.dispatch('deleteServer', id)
        await this.$store.dispatch('serverAll', this.$route.params.id)
      }catch (e) {}
    },
    copy(e){
      if (e.target.closest('li')){
        copyText = e.target.closest('li').querySelector('span')
      }else{
        copyText = e.target.closest('.server__card-host').querySelector('span')
      }
      let copyText;
      let range;
      if (document.selection) {
        // IE
        range = document.body.createTextRange();
        range.moveToElementText(copyText);
        range.select();
      } else if (window.getSelection) {
        range = document.createRange();
        range.selectNode(copyText);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
      }
      document.execCommand('copy');
    }
  },
  computed:{
    servers(){
      return this.$store.getters.getServer
    }
  }
}
</script>

<style lang="scss">
@import "../../../assets/scss/pages/server/app";
</style>